function a(){var a=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function b(a){var b=new Date,c=new Date(a),d=b.getFullYear()-c.getFullYear(),e=b.getMonth()-c.getMonth();(e<0||e===0&&b.getDate()<c.getDate())&&d--;return d}window.log=function(){log.history=log.history||[];log.history.push(arguments);if(this.console){var b=arguments,c;b.callee=b.callee.caller;c=[].slice.call(b);typeof console.log=="object"?log.apply.call(console.log,console,c):console.log.apply(console,c)}};(function(a){function b(){}for(var c="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","),d;!!(d=c.pop());)a[d]=a[d]||b})(function(){try{console.log();return window.console}catch(a){return window.console={}}}());(function(a){var b=a({});a.subscribe=function(){b.on.apply(b,arguments)},a.unsubscribe=function(){b.off.apply(b,arguments)},a.publish=function(){b.trigger.apply(b,arguments)}})(jQuery);Array.prototype.shuffle=function(){for(var a,b,c=this.length;c;a=parseInt(Math.random()*c),b=this[--c],this[c]=this[a],this[a]=b);};!function(a){"use strict";var b=function(b,c){this.$element=a(b);this.options=a.extend({},a.fn.typeahead.defaults,c);this.matcher=this.options.matcher||this.matcher;this.sorter=this.options.sorter||this.sorter;this.highlighter=this.options.highlighter||this.highlighter;this.updater=this.options.updater||this.updater;this.$menu=a(this.options.menu).appendTo("body");this.source=this.options.source;this.shown=!1;this.listen();this.event=this.options.event;this.clear=this.options.clear};b.prototype={constructor:b,select:function(){var a=this.$menu.find(".active").attr("data-value");this.event([a]);this.$element.val(this.updater(a)).change();return this.hide()},updater:function(a){return a},show:function(){var b=a.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});this.$menu.css({top:b.top+b.height,left:b.left});this.$menu.show();this.shown=!0;return this},hide:function(){this.$menu.hide();this.shown=!1;return this},lookup:function(b){var c=this,d,e;this.query=this.$element.val();if(!this.query){this.event(!1);return this.shown?this.hide():this}d=a.grep(this.source,function(a){return c.matcher(a)});d=this.sorter(d);this.event(d);return d.length?this.render(d.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(a){return~a.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(a){var b=[],c=[],d=[],e;while(e=a.shift())e.toLowerCase().indexOf(this.query.toLowerCase())?~e.indexOf(this.query)?c.push(e):d.push(e):b.push(e);return b.concat(c,d)},highlighter:function(a){var b=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return a.replace(new RegExp("("+b+")","ig"),function(a,b){return"<strong>"+b+"</strong>"})},render:function(b){var c=this;b=a(b).map(function(b,d){b=a(c.options.item).attr("data-value",d);b.find("a").html(c.highlighter(d));return b[0]});b.first().addClass("active");this.$menu.html(b);return this},next:function(b){var c=this.$menu.find(".active").removeClass("active"),d=c.next();d.length||(d=a(this.$menu.find("li")[0]));d.addClass("active")},prev:function(a){var b=this.$menu.find(".active").removeClass("active"),c=b.prev();c.length||(c=this.$menu.find("li").last());c.addClass("active")},listen:function(){this.$element.on("blur",a.proxy(this.blur,this)).on("keypress",a.proxy(this.keypress,this)).on("keyup",a.proxy(this.keyup,this));(a.browser.webkit||a.browser.msie)&&this.$element.on("keydown",a.proxy(this.keypress,this));this.$menu.on("click",a.proxy(this.click,this)).on("mouseenter","li",a.proxy(this.mouseenter,this))},keyup:function(a){switch(a.keyCode){case 40:case 38:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();this.clear();break;default:this.lookup()}a.stopPropagation();a.preventDefault()},keypress:function(a){if(!this.shown)return;switch(a.keyCode){case 9:case 13:case 27:a.preventDefault();break;case 38:if(a.type!="keydown")break;a.preventDefault();this.prev();break;case 40:if(a.type!="keydown")break;a.preventDefault();this.next()}a.stopPropagation()},blur:function(a){var b=this;setTimeout(function(){b.hide()},150)},click:function(a){a.stopPropagation();a.preventDefault();this.select()},mouseenter:function(b){this.$menu.find(".active").removeClass("active");a(b.currentTarget).addClass("active")}};a.fn.typeahead=function(c){return this.each(function(){var d=a(this),e=d.data("typeahead"),f=typeof c=="object"&&c;e||d.data("typeahead",e=new b(this,f));typeof c=="string"&&e[c]()})};a.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>'};a.fn.typeahead.Constructor=b;a(function(){a("body").on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(b){var c=a(this);if(c.data("typeahead"))return;b.preventDefault();c.typeahead(c.data())})})}(window.jQuery);var c=gop={debug:!1,storage:{},templates:{},filters:{},view:"list",timeout:0,rel_to_preposition:{single:"",in_a_relationship:"with",engaged:"to",married:"to","it-s_complicated":"with",in_an_open_relationship:"width",widowed:"",separated:"",divorced:"","undefined":""},init:function(){gop.compileTemplates();gop.bindEvents();gop.data.statuses=_.keys(gop.rel_to_preposition);gop.ui.renderStatusFilters()},compileTemplates:function(){gop.templates.friends=_.template('<ul id="friends"><% _.each(friends, function(friend) { %><% if(typeof friend.mate == "object"){ %><li class="rel <%=friend.sex%> hasmate" data-sex="<%=friend.sex%>"><div class="prof friend_prof"><div class="prof_cont"><a target="_blank" href="http://facebook.com/<%=friend.uid %>" class="prof_pic" style="background-image:url(<%= friend.pic %>)"></a><i class="status <%= friend.rel_code%>"></i></div></div><div class="rel_info"><div class="friend_name"><a target="_blank" href="http://facebook.com/<%=friend.uid %>"><%=friend.name %></a></div><div class="status <%=friend.rel_code %>"><%= friend.relationship_status.toLowerCase() %>&nbsp;<div class="preposition"><%= gop.data.preposition(friend.relationship_status) %></div></div><div class="friend_name mate_name"><a target="_blank" href="http://facebook.com/<%=friend.mate.uid%>"><%=friend.mate.name %></a></div></div><div class="prof mate_prof"><div class="prof_cont"><a class="prof_pic" target="_blank" href="http://facebook.com/<%=friend.mate.uid %>" style="background-image:url(<%=friend.mate.pic %>)"></a></div></div></li> <% }else{ %><li class="rel <%=friend.sex%>" data-sex="<%=friend.sex%>"><div class="prof friend_prof"><div class="prof_cont"><a target="_blank" href="http://facebook.com/<%=friend.uid %>" class="prof_pic" style="background-image:url(<%= friend.pic %>)"></a><i class="status <%= friend.rel_code %>"></i></div></div><div class="rel_info nomate_info"><div class="friend_name"><a target="_blank" href="http://facebook.com/<%=friend.uid %>"><%=friend.name %></a></div><% if(friend.relationship_status != "undefined"){ %><div class="status <%=friend.rel_code%>"><%= friend.relationship_status.toLowerCase() %>&nbsp;</div><% } %><% if(friend.relationship_status == "undefined"){ %><div class="is isnot status">is not sharing relationship info</div><% } %></li> <% } %><% }); %></ul>')},bindEvents:function(){$.subscribe("fb/me",gop.ui.renderUser);$.subscribe("fb/status",gop.ui.setState);$.subscribe("fb/status",gop.data.getUserFromFB);$.subscribe("fb/connected",gop.connected);$.subscribe("fb/fetched_friends",gop.ui.render);$.subscribe("fb/fetched_friends",gop.bindDependantEvents);$.subscribe("fb/fetched_friends",gop.data.groupByStatus);$.subscribe("fb/fetched_friends",gop.ui.addCountToFilters);$("#sort").on("click",".sort_by",function(a){window.setTimeout(function(){var a=$(".sort_tags li").filter(function(){return $(this).find("input").prop("checked")});gop.filters={};a.each(function(){var a=$(this).data("category");typeof gop.filters[a]=="undefined"&&(gop.filters[a]=[]);gop.filters[a].push($(this).data("status"))});gop.data.filterCouples()},100)});$("#view_cont").on("click",".view",function(){gop.ui.changeView($(this).attr("id"))});$("#friends_body").on("mouseenter",".rel",function(){if(gop.view=="thumb"){clearTimeout(gop.timeout);$friend=$(this);gop.timeout=setTimeout(function(){$("#friends_footer").html($friend.find(".rel_info").clone());$("#friends_footer")[0].className=$friend.data("sex")},250)}});$("#friends_body").on("mouseleave",function(){gop.view=="thumb"&&clearTimeout(gop.timeout)});$("#friends_cont").on("mouseleave",function(){$("#friends_footer").html()})},bindDependantEvents:function(a,b){$("#search_input").typeahead({source:_.map(gop.data.friends,function(a){return a.name}),event:function(a){if(a!==!1){var b=_.filter(gop.data.friends,function(b){return _.indexOf(a,b.name)>-1});gop.ui.render(null,b);$("#search_cont").addClass("active")}else{gop.ui.render(null,gop.data.friends);$("#search_cont").removeClass("active")}},clear:gop.ui.clearSearch()});$("#clear_search").on("click",gop.ui.clearSearch)},connected:function(a,b){gop.data.getFriends()}};gop.data={friends:{},mates:{},count:{sex:{male:0,female:0},rel_code:{}},getFriends:function(){gop.debug?friends&&gop.data.handleFriends(friends):gop.data.getFriendsFromFB()},getFriendsFromFB:function(){FB.api({method:"fql.multiquery",queries:{friends:"SELECT uid, name,sex ,mutual_friend_count,birthday_date, pic,relationship_status, significant_other_id FROM user WHERE uid IN (SELECT uid2 FROM friend WHERE uid1 = me()) ORDER BY name",significant_others:'SELECT uid, name,pic FROM user WHERE uid in (SELECT significant_other_id FROM #friends WHERE relationship_status != "")'}},function(a){gop.data.handleFriends(a)})},getUserFromFB:function(){FB.api("/me",function(a){$.publish("fb/me",a)})},handleFriends:function(a){var b=a[0].fql_result_set,c=a[1].fql_result_set;for(var d=0;d<c.length;d++)gop.data.mates[c[d].uid]=c[d];for(var d=0;d<b.length;d++){var e=b[d],f=gop.data.mates[e.significant_other_id];e.mate=f;if(e.relationship_status!=null)rel_status=e.relationship_status.toLowerCase().split(" ").join("_").split("'").join("-");else{rel_status="undefined";e.relationship_status="undefined"}e.sex=="male"?gop.data.count.sex.male+=1:gop.data.count.sex.female+=1;typeof gop.data.count.rel_code[rel_status]=="undefined"?gop.data.count.rel_code[rel_status]=1:gop.data.count.rel_code[rel_status]+=1;e.rel_code=rel_status}gop.data.friends=b;$.publish("fb/fetched_friends")},preposition:function(a){a=a||"undefined";a=a.toLowerCase().split(" ").join("_").split("'").join("-");return gop.rel_to_preposition[a]},groupByStatus:function(a,b){b=b||gop.data.friends;gop.data.friends_by_status=_.groupBy(b,function(a){return a.relationship_status})},filterCouples:function(){gop.data.friends_by_status=_.filter(gop.data.friends,function(a){return gop.data.friendMatchesFilters(a)});gop.ui.render(null,gop.data.friends_by_status);gop.ui.renderBG()},friendMatchesFilters:function(a){var b=0;$.each(gop.filters,function(c,d){var e=c;typeof a[e]!="undefined"&&$.each(d,function(c,d){a[e]==d&&(b+=1)})});return b==_.keys(gop.filters).length}};gop.ui={renderStatusFilters:function(){var a='<ul class="sort_tags"><% _.each(statuses,function(status){ %><li data-category="rel_code"  data-status="<%= status %>"><input type="checkbox" name="<%= status %>" id="<%= status %>"><label for="<%= status %>" class="sort_by"><i class="icon-tag"></i><span class="filter"><%= status.split("_").join(" ").split("-").join("\'") %></span> <span class="ammount"></span></label></li> <% }) %></ul>',b={statuses:gop.data.statuses},c=_.template(a,b);$("#sort").append(c)},addCountToFilters:function(){$(".sort_tags li").each(function(){var a=$(this).data("category"),b=$(this).data("status"),c=gop.data.count[a][b];!c>0&&(c=0);$(this).find(".ammount").html("("+c+")")})},render:function(a,b){b=b||gop.data.friends;var c=gop.templates.friends({friends:b});$("#friends_body").empty().append(c);gop.ui.renderCountString(b.length)},renderCountString:function(a){var b="",c="";gop.filters.sex&&gop.filters.sex.length==1&&(b=gop.filters.sex.join(", "));gop.filters.rel_code&&(c=gop.filters.rel_code.join(", "));$("#showing").html('Showing <span class="count">'+a+"</span> "+b+" friends")},renderUser:function(a,b){b.rel_code=b.relationship_status.toLowerCase().split(" ").join("_").split("'").join("-");var c='<div class="small_user_pic" style="background-image:url(https://graph.facebook.com/<%=user.id%>/picture)"/> Hi <%=user.first_name%>, you are <div class="small_rel_info <%=user.rel_code %>"><%=user.relationship_status%></div> | <a href="#" id="logout">logout</a>',d={user:b},e=_.template(c,d);$(".userdata").append(e).data({sex:b.sex,rel_code:b.rel_code});gop.ui.renderBG(b.rel_code,b.sex)},renderBG:function(a,b){$body=$("body");$body[0].className="";$body.addClass($body.data("state"));if(gop.filters&&gop.filters.rel_code){gop.filters.sex&&gop.filters.sex.length==1?b=gop.filters.sex[0]:b=$(".userdata").data("sex");a=gop.filters.rel_code.length==1?gop.filters.rel_code[0]:"all"}else{b=$(".userdata").data("sex");a=$(".userdata").data("rel_code")}$body.addClass(a).addClass(b)},setState:function(a,b){b=b||"disconnected";$("body").removeClass("disconnected connected").addClass(b).attr("data-state",b);b=="connected"&&$.publish("fb/connected",b)},changeView:function(a){$(".view").removeClass("selected");$("#"+a).addClass("selected");gop.view=a;$("#friends_cont")[0].className=a},clearSearch:function(){gop.ui.render(null,gop.data.friends);$("#search_cont").removeClass("active");$("#search_input").val("")}};window.fbAsyncInit=function(){function a(a){var b=$(".login");if(a.authResponse){gop.init();b.on("click",function(){$.publish("fb/status","connected")})}else b.on("click",function(){FB.login(function(a){if(a.authResponse){gop.init();$.publish("fb/status","connected")}else console.log("handle user denial!")},{scope:"user_relationships,user_relationship_details,friends_relationships,friends_relationship_details ,friends_birthday"})})}FB.init({appId:"397573470274307",status:!0,cookie:!0,xfbml:!0,oauth:!0});FB.getLoginStatus(a)};