function a(){var a=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function b(a){var b=new Date,c=new Date(a),d=b.getFullYear()-c.getFullYear(),e=b.getMonth()-c.getMonth();(e<0||e===0&&b.getDate()<c.getDate())&&d--;return d}window.log=function(){log.history=log.history||[];log.history.push(arguments);if(this.console){var b=arguments,c;b.callee=b.callee.caller;c=[].slice.call(b);typeof console.log=="object"?log.apply.call(console.log,console,c):console.log.apply(console,c)}};(function(a){function b(){}for(var c="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","),d;!!(d=c.pop());)a[d]=a[d]||b})(function(){try{console.log();return window.console}catch(a){return window.console={}}}());(function(a){var b=a({});a.subscribe=function(){b.on.apply(b,arguments)},a.unsubscribe=function(){b.off.apply(b,arguments)},a.publish=function(){b.trigger.apply(b,arguments)}})(jQuery);Array.prototype.shuffle=function(){for(var a,b,c=this.length;c;a=parseInt(Math.random()*c),b=this[--c],this[c]=this[a],this[a]=b);};var c=gop={debug:!1,storage:{},templates:{},filters:{},rel_to_preposition:{single:"",in_a_relationship:"with",engaged:"to",married:"to","it's_complicated":"with",in_an_open_relationship:"width",widowed:"",separated:"",divorced:"","undefined":""},init:function(){gop.compileTemplates();gop.bindEvents();gop.data.statuses=_.keys(gop.rel_to_preposition);gop.ui.renderStatusFilters()},compileTemplates:function(){gop.templates.friends=_.template('<ul id="friends"><% _.each(friends, function(friend) { %><% if(typeof friend.mate == "object"){ %><li class="rel <%=friend.sex%> hasmate"><div class="prof friend_prof"><div class="prof_cont"><a href="http://facebook.com/<%=friend.uid %>" class="prof_pic" style="background-image:url(<%= friend.pic %>)"></a></div></div><div class="rel_info"><div class="friend_name"><a href="http://facebook.com/<%=friend.uid %>"><%=friend.name %></a></div><div class="status <%=friend.rel_code%>"><%= friend.relationship_status.toLowerCase() %>&nbsp;<div class="preposition"><%= gop.data.preposition(friend.relationship_status) %></div></div><div class="friend_name mate_name"><a href="http://facebook.com/<%=friend.mate.uid%>"><%=friend.mate.name %></a></div></div><div class="prof mate_prof"><div class="prof_cont"><a class="prof_pic" href="http://facebook.com/<%=friend.mate.uid %>" style="background-image:url(<%=friend.mate.pic %>)"></a></div></div></li> <% }else{ %><li class="rel <%=friend.sex%>"><div class="prof friend_prof"><div class="prof_cont"><a href="http://facebook.com/<%=friend.uid %>" class="prof_pic" style="background-image:url(<%= friend.pic %>)"></a></div></div><div class="rel_info nomate_info"><div class="friend_name"><a href="http://facebook.com/<%=friend.uid %>"><%=friend.name %></a></div><% if(friend.relationship_status != "undefined"){ %><div class="status <%=friend.rel_code%>"><div class="is">is</div> <%= friend.relationship_status.toLowerCase() %>&nbsp;</div><% } %><% if(friend.relationship_status == "undefined"){ %><div class="is isnot status">is not sharing relationship info</div><% } %></li> <% } %><% }); %></ul>')},bindEvents:function(){$.subscribe("fb/me",gop.ui.renderUser);$.subscribe("fb/status",gop.ui.setState);$.subscribe("fb/status",gop.data.getUserFromFB);$.subscribe("fb/connected",gop.connected);$.subscribe("fb/fetched_friends",gop.ui.render);$.subscribe("fb/fetched_friends",gop.data.groupByStatus);$("#sort").on("click",".sort_by",function(a){window.setTimeout(function(){var a=$(".sort_tags input").filter(function(){return $(this).prop("checked")});gop.filters={};a.each(function(){var a=$(this).data("category");typeof gop.filters[a]=="undefined"&&(gop.filters[a]=[]);gop.filters[a].push($(this).prop("id").split(" ").join("_"))});gop.data.filterCouples()},100)})},connected:function(a,b){gop.data.getFriends()}};gop.data={friends:{},mates:{},by_status:{},by_sex:{},getFriends:function(){gop.debug?friends&&gop.data.handleFriends(friends):gop.data.getFriendsFromFB()},getFriendsFromFB:function(){FB.api({method:"fql.multiquery",queries:{friends:"SELECT uid, name,sex ,mutual_friend_count,birthday_date, pic,relationship_status, significant_other_id FROM user WHERE uid IN (SELECT uid2 FROM friend WHERE uid1 = me()) ORDER BY name",significant_others:'SELECT uid, name,pic FROM user WHERE uid in (SELECT significant_other_id FROM #friends WHERE relationship_status != "")'}},function(a){gop.data.handleFriends(a)})},getUserFromFB:function(){FB.api("/me",function(a){$.publish("fb/me",a)})},handleFriends:function(a){var b=a[0].fql_result_set,c=a[1].fql_result_set;for(var d=0;d<c.length;d++)gop.data.mates[c[d].uid]=c[d];for(var d=0;d<b.length;d++){var e=b[d];console.log(e.interested_in);var f=gop.data.mates[e.significant_other_id];e.mate=f;if(e.relationship_status!=null)rel_status=e.relationship_status.toLowerCase().split(" ").join("_");else{rel_status="undefined";e.relationship_status="undefined"}e.rel_code=rel_status}gop.data.friends=b;$.publish("fb/fetched_friends")},preposition:function(a){a=a||"undefined";a=a.toLowerCase().split(" ").join("_");return gop.rel_to_preposition[a]},groupByStatus:function(a,b){b=b||gop.data.friends;gop.data.friends_by_status=_.groupBy(b,function(a){return a.relationship_status})},filterCouples:function(){gop.data.friends_by_status=_.filter(gop.data.friends,function(a){return gop.data.friendMatchesFilters(a)});gop.ui.render(null,gop.data.friends_by_status)},friendMatchesFilters:function(a){var b=0;$.each(gop.filters,function(c,d){var e=c;typeof a[e]!="undefined"&&$.each(d,function(c,d){a[e]==d&&(b+=1)})});return b==_.keys(gop.filters).length}};gop.ui={renderStatusFilters:function(){var a='<h5>Relationship Status:</h5><ul class="sort_tags"><% _.each(statuses,function(status){ %><li><input type="checkbox" data-category="rel_code" name="<%= status %>" id="<%= status %>"><label for="<%= status %>" class="sort_by"><%= status.split("_").join(" ") %></label></li> <% }) %></ul>',b={statuses:gop.data.statuses},c=_.template(a,b);$("#sort").append(c)},render:function(a,b){b=b||gop.data.friends;var c=gop.templates.friends({friends:b});$("#friends_body").empty().append(c)},renderUser:function(a,b){b.rel_code=b.relationship_status.toLowerCase().split(" ").join("_");var c='<div class="small_user_pic" style="background-image:url(https://graph.facebook.com/<%=user.id%>/picture)"/> Hi <%=user.first_name%>, you are <div class="small_rel_info <%=user.rel_code %>"><%=user.relationship_status%></div> | <a href="#" id="logout">logout</a>',d={user:b},e=_.template(c,d);$(".userdata").append(e)},setState:function(a,b){b=b||"disconnected";document.body.dataset.state=b;b=="connected"&&$.publish("fb/connected",b)}};window.fbAsyncInit=function(){function a(a){var b=$("#login");if(a.authResponse){gop.init();b.on("click",function(){$.publish("fb/status","connected")})}else b.on("click",function(){FB.login(function(a){if(a.authResponse){gop.init();$.publish("fb/status","connected")}else console.log("handle user denial!")},{scope:"user_relationships,user_relationship_details,friends_relationships,friends_relationship_details ,friends_birthday"})})}FB.init({appId:"397573470274307",status:!0,cookie:!0,xfbml:!0,oauth:!0});FB.getLoginStatus(a)};